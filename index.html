<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ماشین حساب معدل حرفه‌ای</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Tahoma, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
.container { width: 95%; max-width: 900px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
h2 { text-align:center; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; text-align: center; }
th, td { border: 1px solid #ccc; padding: 8px; }
th { background: #36a2eb; color: #fff; }
button { margin-top: 10px; padding: 6px 12px; border: none; border-radius: 6px; background: #36a2eb; color: #fff; cursor: pointer; }
button:hover { background: #2381c7; }
input { width: 60px; text-align:center; }
.card { background: #f0f8ff; padding: 10px 15px; border-radius: 8px; margin-top: 10px; font-weight: bold; text-align:center; }
#chartControls { margin-top: 15px; text-align:center; }
#charts { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; justify-content: center; }
.chart-container { flex: 1 1 400px; background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 10px; }
select { padding: 4px 8px; margin-left: 8px; }
</style>
</head>
<body>
<div class="container">
<h2>ماشین حساب معدل حرفه‌ای با انتخاب نمودار</h2>

<table id="gpaTable">
<thead>
<tr><th>ترم</th><th>نمره</th><th>واحد</th><th>امتیاز ترم</th></tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
<tr>
<td>2</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
<tr>
<td>3</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
<tr>
<td>4</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
<tr>
<td>5</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
<tr>
<td>6</td>
<td><input type="number" value="0" min="0" max="20"></td>
<td><input type="number" value="0" min="0"></td>
<td class="score">0</td>
</tr>
</tbody>
</table>

<button id="addRowBtn">➕ ترم جدید</button>
<div class="card">معدل کل: <span id="gpa">-</span></div>

<div id="chartControls">
<label>نوع نمودار: 
<select id="chartTypeSelect">
<option value="bar">ستونی</option>
<option value="line">خطی</option>
<option value="pie">دایره‌ای</option>
<option value="radar">راداری</option>
</select>
</label>
</div>

<div id="charts">
<div class="chart-container"><canvas id="mainChart"></canvas></div>
</div>

</div>

<script>
const table = document.getElementById('gpaTable');
const gpaDisplay = document.getElementById('gpa');
const addRowBtn = document.getElementById('addRowBtn');
const chartTypeSelect = document.getElementById('chartTypeSelect');
let mainChart;

function calculateGPA() {
    const rows = table.querySelectorAll('tbody tr');
    let totalUnits = 0, totalScore = 0;
    const grades = [], units = [];
    rows.forEach(row => {
        const grade = parseFloat(row.children[1].children[0].value)||0;
        const unit = parseFloat(row.children[2].children[0].value)||0;
        const score = grade*unit;
        row.children[3].textContent = score.toFixed(2);
        totalUnits += unit;
        totalScore += score;
        grades.push(grade);
        units.push(unit);
    });
    const gpa = totalUnits>0 ? totalScore/totalUnits : 0;
    gpaDisplay.textContent = gpa.toFixed(2);
    updateChart(grades, units);
}

function attachInputEvents(row){
    const inputs = row.querySelectorAll('input');
    inputs.forEach(input => input.addEventListener('input', calculateGPA));
}

addRowBtn.addEventListener('click', ()=>{
    const tbody = table.querySelector('tbody');
    const newRow = document.createElement('tr');
    const termNumber = tbody.rows.length + 1;
    newRow.innerHTML = `<td>${termNumber}</td>
        <td><input type='number' value='0' min='0' max='20'></td>
        <td><input type='number' value='0' min='0'></td>
        <td class='score'>0</td>`;
    tbody.appendChild(newRow);
    attachInputEvents(newRow);
    calculateGPA();
});

chartTypeSelect.addEventListener('change', calculateGPA);

function updateChart(grades, units){
    const labels = grades.map((_,i)=>`ترم ${i+1}`);
    const chartData = {
        labels: labels,
        datasets: [{
            label: 'اثر ترم (نمره × واحد)',
            data: grades.map((g,i)=>g*units[i]),
            backgroundColor: 'rgba(54,162,235,0.5)',
            borderColor: 'rgba(54,162,235,1)',
            borderWidth: 1,
            fill: true,
        }]
    };
    const type = chartTypeSelect.value;
    if(mainChart){
        mainChart.destroy();
    }
    mainChart = new Chart(document.getElementById('mainChart').getContext('2d'), {
        type: type,
        data: chartData,
        options: { responsive:true, scales:{ y:{ beginAtZero:true } } }
    });
}

// فعال کردن input های اولیه
table.querySelectorAll('tbody tr').forEach(attachInputEvents);

// محاسبه اولیه
calculateGPA();
</script>
</body>
</html>